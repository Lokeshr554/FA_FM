/*
 * Licensed Materials - Property of IBM
 *
 * Copyright IBM Corporation 2015. All Rights Reserved.
 *
 * U.S. Government Users Restricted Rights - Use, duplication or
 * disclosure restricted by GSA DP Schedule Contract with IBM Corp.
 */
define(["dojo/_base/array","dojo/_base/declare","dojo/dom","dojo/sniff","dojo/keys","dojo/_base/lang","dojo/on","../main"],function(_ae1,_ae2,dom,has,keys,lang,on,_ae3){var _ae4=_ae2("dijit.form._TextBoxMixin"+(has("dojo-bidi")?"_NoBidi":""),null,{trim:false,uppercase:false,lowercase:false,propercase:false,maxLength:"",selectOnClick:false,placeHolder:"",_getValueAttr:function(){return this.parse(this.get("displayedValue"),this.constraints);},_setValueAttr:function(_ae5,_ae6,_ae7){var _ae8;if(_ae5!==undefined){_ae8=this.filter(_ae5);if(typeof _ae7!="string"){if(_ae8!==null&&((typeof _ae8!="number")||!isNaN(_ae8))){_ae7=this.filter(this.format(_ae8,this.constraints));}else{_ae7="";}if(this.compare(_ae8,this.filter(this.parse(_ae7,this.constraints)))!=0){_ae7=null;}}}if(_ae7!=null&&((typeof _ae7)!="number"||!isNaN(_ae7))&&this.textbox.value!=_ae7){this.textbox.value=_ae7;this._set("displayedValue",this.get("displayedValue"));}this.inherited(arguments,[_ae8,_ae6]);},displayedValue:"",_getDisplayedValueAttr:function(){return this.filter(this.textbox.value);},_setDisplayedValueAttr:function(_ae9){if(_ae9==null){_ae9="";}else{if(typeof _ae9!="string"){_ae9=String(_ae9);}}this.textbox.value=_ae9;this._setValueAttr(this.get("value"),undefined);this._set("displayedValue",this.get("displayedValue"));},format:function(_aea){return _aea==null?"":(_aea.toString?_aea.toString():_aea);},parse:function(_aeb){return _aeb;},_refreshState:function(){},onInput:function(evt){this._lastInputProducingEvent=evt;},_onInput:function(){this._lastInputEventValue=this.textbox.value;this._processInput(this._lastInputProducingEvent);if(this.intermediateChanges){this._handleOnChange(this.get("value"),false);}},_processInput:function(evt){this._refreshState();this._set("displayedValue",this.get("displayedValue"));},postCreate:function(){this.textbox.setAttribute("value",this.textbox.value);this.inherited(arguments);function _aec(e){var _aed;if(e.type=="keydown"){_aed=e.keyCode;switch(_aed){case keys.SHIFT:case keys.ALT:case keys.CTRL:case keys.META:case keys.CAPS_LOCK:case keys.NUM_LOCK:case keys.SCROLL_LOCK:return;}if(!e.ctrlKey&&!e.metaKey&&!e.altKey){switch(_aed){case keys.NUMPAD_0:case keys.NUMPAD_1:case keys.NUMPAD_2:case keys.NUMPAD_3:case keys.NUMPAD_4:case keys.NUMPAD_5:case keys.NUMPAD_6:case keys.NUMPAD_7:case keys.NUMPAD_8:case keys.NUMPAD_9:case keys.NUMPAD_MULTIPLY:case keys.NUMPAD_PLUS:case keys.NUMPAD_ENTER:case keys.NUMPAD_MINUS:case keys.NUMPAD_PERIOD:case keys.NUMPAD_DIVIDE:return;}if((_aed>=65&&_aed<=90)||(_aed>=48&&_aed<=57)||_aed==keys.SPACE){return;}var _aee=false;for(var i in keys){if(keys[i]===e.keyCode){_aee=true;break;}}if(!_aee){return;}}}_aed=e.charCode>=32?String.fromCharCode(e.charCode):e.charCode;if(!_aed){_aed=(e.keyCode>=65&&e.keyCode<=90)||(e.keyCode>=48&&e.keyCode<=57)||e.keyCode==keys.SPACE?String.fromCharCode(e.keyCode):e.keyCode;}if(!_aed){_aed=229;}if(e.type=="keypress"){if(typeof _aed!="string"){return;}if((_aed>="a"&&_aed<="z")||(_aed>="A"&&_aed<="Z")||(_aed>="0"&&_aed<="9")||(_aed===" ")){if(e.ctrlKey||e.metaKey||e.altKey){return;}}}var faux={faux:true},attr;for(attr in e){if(!/^(layer[XY]|returnValue|keyLocation)$/.test(attr)){var v=e[attr];if(typeof v!="function"&&typeof v!="undefined"){faux[attr]=v;}}}lang.mixin(faux,{charOrCode:_aed,_wasConsumed:false,preventDefault:function(){faux._wasConsumed=true;e.preventDefault();},stopPropagation:function(){e.stopPropagation();}});if(this.onInput(faux)===false){faux.preventDefault();faux.stopPropagation();}if(faux._wasConsumed){return;}if(has("ie")<=9){switch(e.keyCode){case keys.TAB:case keys.ESCAPE:case keys.DOWN_ARROW:case keys.UP_ARROW:case keys.LEFT_ARROW:case keys.RIGHT_ARROW:break;default:if(e.keyCode==keys.ENTER&&this.textbox.tagName.toLowerCase()!="textarea"){break;}this.defer(function(){if(this.textbox.value!==this._lastInputEventValue){on.emit(this.textbox,"input",{bubbles:true});}});}}};this.own(on(this.textbox,"keydown, keypress, paste, cut, compositionend",lang.hitch(this,_aec)),on(this.textbox,"input",lang.hitch(this,"_onInput")),on(this.domNode,"keypress",function(e){}));},_blankValue:"",filter:function(val){if(val===null){return this._blankValue;}if(typeof val!="string"){return val;}if(this.trim){val=lang.trim(val);}if(this.uppercase){val=val.toUpperCase();}if(this.lowercase){val=val.toLowerCase();}if(this.propercase){val=val.replace(/[^\s]+/g,function(word){return word.substring(0,1).toUpperCase()+word.substring(1);});}return val;},_setBlurValue:function(){this._setValueAttr(this.get("value"),true);},_onBlur:function(e){if(this.disabled){return;}this._setBlurValue();this.inherited(arguments);},_isTextSelected:function(){return this.textbox.selectionStart!=this.textbox.selectionEnd;},_onFocus:function(by){if(this.disabled||this.readOnly){return;}if(this.selectOnClick&&by=="mouse"){this._selectOnClickHandle=on.once(this.domNode,"mouseup, touchend",lang.hitch(this,function(evt){if(!this._isTextSelected()){_ae4.selectInputText(this.textbox);}}));this.own(this._selectOnClickHandle);this.defer(function(){if(this._selectOnClickHandle){this._selectOnClickHandle.remove();this._selectOnClickHandle=null;}},500);}this.inherited(arguments);this._refreshState();},reset:function(){this.textbox.value="";this.inherited(arguments);}});if(has("dojo-bidi")){_ae4=_ae2("dijit.form._TextBoxMixin",_ae4,{_setValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode);},_setDisplayedValueAttr:function(){this.inherited(arguments);this.applyTextDir(this.focusNode);},_onInput:function(){this.applyTextDir(this.focusNode);this.inherited(arguments);}});}_ae4._setSelectionRange=_ae3._setSelectionRange=function(_aef,_af0,stop){if(_aef.setSelectionRange){_aef.setSelectionRange(_af0,stop);}};_ae4.selectInputText=_ae3.selectInputText=function(_af1,_af2,stop){_af1=dom.byId(_af1);if(isNaN(_af2)){_af2=0;}if(isNaN(stop)){stop=_af1.value?_af1.value.length:0;}try{_af1.focus();_ae4._setSelectionRange(_af1,_af2,stop);}catch(e){}};return _ae4;});